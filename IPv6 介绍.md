# IPv6 介绍

## IPv4互联网面临挑战

- 需要更大的通信能力，使人们拥有更多有价值的服务和应用
- IPv4剩余可分配地址严重不足，影响互连网深化发展
- “尽力而为”服务，质量没有保证
- 网络安全保护能力有限，存在隐患
- 数字鸿沟扩大，互联网普及受阻
- 如何推陈出新，提供更有价值的服务，避免走入死胡同

## IPv6的优势

- 几乎无限的地址空间，由32位扩充到128位，彻底解决IPv4地址不足的问题
- 简化固定报文头，提高效率
- 灵活的扩展报头，协议易扩展
- 地址格式更具层次性，便于路由聚合 
- 无状态自动配置，实现即插即用
- 网络层的IPSec认证与加密，端到端安全   
- 新增流标记域，提供QoS保证
- 有效支持移动网络、实时通信，IPv6具备强大的自动配置能力

## IPv6地址介绍

### 地址长度为何是128位？

* 在计算机中，当数据能用2的指数次幂字长位的二进制数表示时，CPU对数值的处理效率最高
* IPv4地址对应的是32比特字长，就是因为当时的互联网上的主机CPU字长为32位
* 128位机正在成长中，若定为64位，在网络扩展性上显得不足，因此从处理效率和未来网络扩展性上考虑，将IPv6的地址长度定为128位是十分合适的
* 共有2的128次方幂个IPv6地址，可分配地址数有340,282,366,920,938,463,463,374,607,431,768,211,456个
* 若按土地面积分配，每平方厘米可获得2.2*1020个地址。地球上每一粒沙子都会有一个IP地址

### 地址结构

- **IPv6地址 **= **前缀** **+** **接口标识**

  > **前缀**：相当于IPv4地址中的网络ID
  >
  > **接口标识**：相当于IPv4地址中的主机ID
  >
  > **本地链路地址:**  FE80::5ED9 : 98FF:FECA:A298
  >
  > **全球单播地址**:  2001:A304:6101:0001 : *5ED9:98FF:FECA:A298*

- **接口ID如何生成**

  > **由IEEE EUI-64规范自动生成 ：**    ![img](file:///C:/Users/y30004926/AppData/Roaming/eSpace_Desktop/UserData/y30004926/imagefiles/E5F5FE19-3EF4-4D43-9CC9-A84EDA6B2FCF.png)

  > **设备随机生成：**目前Windows XP支持该方式

  > **手动配置：**人为指定接口ID

### 地址格式

- **首选格式**

> 用十六进制表示，如：FE08:….
>
> 4个数字一组(16bits)，中间用 “ : ” 隔开，如：2001:12FC:….
>
> 地址前缀长度用“/xx”来表示
>
> 例如：2001:0410:0000:0001:0000:0000:0000:45ff/64

- **压缩格式**

> 若以零开头可以省略，连续全零的组可用“::”表示，如：  1:2::ACDE:….
>
> 一个地址中::只能出现一次
>
> 地址前缀长度用“/xx”来表示
>
> 例如： 2001:410:0:1::45ff/64

- **内嵌IPv4地址的格式**

> IPv6地址的其它部分（不包括IPv4地址的部分）可以采用首选或者压缩格式
>
> IPv6地址中内嵌的IPv4地址采用IPv4的十进制表示方法
>
> 地址前缀长度用“/xx”来表示
>
> 例如：0:0:0:0:0:0:166.168.1.2/64

### 地址类型

- **单播地址 ：** 标识一个接口，目的为单播地址的报文会被送到被标识的接口

> **未指定地址：**
>
> > 全0，表示为 ::/128
> >
> > 仅用于接口没有分配地址时作为源地址
> >
> > 在重复地址检测中出现
> >
> > 含有未指定地址的包不会被转发
>
> **环回地址：**
>
> > 表示为 ::1/128，如同IPv4中的127.0.0.1
>
> **全球单播地址 GUA：** 
>
> > 全球路由前缀（n bits）+ 子网ID（m bits）+ 接口ID（128-n-m bits），其中前两部分形成了IPv6的前缀，目前已经分配的全球单播地址前缀都是以001开头的，分配范围有以下几个：
> >
> > - 2001::/16                           IPv6 Internet
> >
> > - 2002::/16                           6 to 4 隧道
> >
> > - 2003::/16---3EED::/16      未分配
> >
> > - 3FFE::/16                            6 bone
>
> **内嵌IPv4地址的IPv6地址：**
>
> > IPv4兼容IPv6 ：以96位0加上32位IPv4地址形成，用于IPv4兼容IPv6自动隧道
> >
> > IPv4映射IPv6 ：以80位0加上16位1，再加上32位IPv4地址形成，用于IPv4与IPv6的互通
>
> **链路本地地址 LLA：**
>
> > 只能在连接到同一本地链路的节点之间使用
> >
> > 前缀 FE80::/64（最高10位值为1111111010），接口ID（使用IEEE EUI-64生成）作为地址的低64比特
> >
> > 当一个节点启动IPv6协议栈时，启动时节点的每个接口会<u>*自动配置*</u>一个链路本地地址
>
> **唯一本地地址 ULA：**
>
> > 仅能在一个站点内使用，不是自动生成的，类似于IPv4中的私有地址
> >
> > 前48位总是固定（最高10位值为1111111011），紧跟连续38位0。在接口ID和48位特定前缀之间有16位子网ID字段，供机构在内部构建子网

- **组播地址 ：** 标识多个接口，目的为组播地址的报文会被送到被标识的所有接口

- **任播地址 ：** 标识多个接口，目的为任播地址的报文会被送到最近的一个被标识接口，最近节点是由路由协议来定义的。任播地址与单播地址使用同一个地址空间，即由路由器决定数据包是做任播转发还是单播转发。
